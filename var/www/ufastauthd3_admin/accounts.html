<!--<%include:/includes/inc.main.header.html%>-->

<!--<%include:/includes/inc.layout.leftpanel.header.html%>-->
<!--<%include:/includes/accounts/inc.links.accounts.html%>-->
<!--<%include:/includes/inc.layout.leftpanel.middle.html%>-->


<script>

  document.getElementById("apptitle").innerHTML = "Accounts &#9658; Accounts Directory";
  document.getElementById("mainview-accounts-directory-link").style.color = "white";

  /*
        document.getElementById(`ulist - status - ${ userId } `).innerHTML = " <span class=\"badge bg-primary\">Operational</span>";
      else {
        if (userInfo["enabled"] == false)
          document.getElementById(`ulist - status - ${ userId } `).innerHTML = document.getElementById(`ulist - status - ${ userId } `).innerHTML + " <span class=\"badge bg-dark\">Disabled</span>";
        if (userInfo["confirmed"] == false)
          document.getElementById(`ulist - status - ${ userId } `).innerHTML = document.getElementById(`ulist - status - ${ userId } `).innerHTML + " <span class=\"badge bg-warning\">Unconfirmed</span>";
        if (userInfo["expired"] == true)
          document.getElementById(`ulist - status - ${ userId } `).innerHTML = document.getElementById(`ulist - status - ${ userId } `).innerHTML + " <span class=\"badge bg-warning\">Expired</span>";
      }
      if (userInfo["superuser"] == true)
        document.getElementById(`ulist - status - ${ userId } `).innerHTML = document.getElementById(`ulist - status - ${ userId }`).innerHTML + " <span class=\"badge bg-danger\">Administrator</span>";
  */

</script>

<div class="container-fluid" style="width: 95%;">
  <div class="d-flex justify-content-end mb-3">


    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalCreateAccount" onclick="createAccountClearParameters()">
      Add Account
    </button>

  </div>
  <hr>
  <table id="accountsTable" class="display">
    <thead>
      <tr>
        <th scope="col">Account Name</th>
        <th scope="col">Creation</th>
        <th scope="col">Expiration</th>
        <th scope="col">Last Access</th>
        <th scope="col">Last Password Change</th>
        <th scope="col">Roles</th>
        <th scope="col">Applications</th>
        <th scope="col">Status</th>
        <th scope="col" style="text-align: right;">Controls&nbsp;</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
</div>

<script>
  new DataTable('#accountsTable', {
    ajax: {
      "url": "/api/v1/searchAccounts",
      "type": 'GET',
      "data": function (d) {
        return JSON.stringify(d);
      }
    },
    processing: true,
    serverSide: true,
    columns: [
      {
        data: "accountName",
        title: "Account Name",
        render: function (data, type, row) {
          return '<i class="fa-regular fa-circle-user"></i> &nbsp;&nbsp;' + data;
        }
      },
      {
        data: "creation",
        title: "Creation",
        searchable: false,
        render: function (data, type, row) {
          if (data === null || data === 0) return 'Never';
          var date = new Date(data * 1000);
          return date.toLocaleString();
        }
      },
      {
        data: "expiration",
        title: "Expiration",
        searchable: false,
        render: function (data, type, row) {
          if (data === null || data === 0) return 'Never';
          var date = new Date(data * 1000);
          return date.toLocaleString();
        }
      },
      {
        data: "lastAccess",
        title: "Last Access",
        searchable: false,
        render: function (data, type, row) {
          if (data === null || data === 0) return 'Never';
          var date = new Date(data * 1000);
          return date.toLocaleString();
        }
      },
      {
        data: "lastPasswordChange",
        title: "Last Password Change",
        searchable: false,
        render: function (data, type, row) {
          if (data === null || data === 0) return 'Never';
          var date = new Date(data * 1000);
          var today = new Date();
          var diffTime = Math.abs(today - date);
          var diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          return diffDays + " days ago";
        }
      },
      {
        data: "roles",
        searchable: false,
        title: "Roles"
      },
      {
        data: "applications",
        searchable: false,
        title: "Applications"
      },
      {
        data: null,
        orderable: false,
        searchable: false,
        render: function (data, type, row) {

          let statusHtml = '<div class="d-flex flex-wrap gap-1">';
          if (row.DT_RowData.isEnabled === true && row.DT_RowData.isAccountConfirmed === true && row.DT_RowData.isBlocked === false)
            statusHtml += '<span class="badge bg-primary">Operational</span>';
          else {
            if (row.DT_RowData.isEnabled === false)
              statusHtml += '<span class="badge bg-dark">Disabled</span>';
            if (row.DT_RowData.isAccountConfirmed === false)
              statusHtml += '<span class="badge bg-warning">Unconfirmed</span>';
            if (row.DT_RowData.isBlocked === true)
              statusHtml += '<span class="badge bg-warning">Blocked</span>';
          }
          if (row.DT_RowData.isAdmin === true)
            statusHtml += '<span class="badge bg-danger">Administrator</span>';


          statusHtml += '</div>';


          return statusHtml;
        }
      },
      {
        data: null,
        orderable: false,
        searchable: false,
        render: function (data, type, row) {
          let b64AccountName = window.btoa(row.accountName);
          return `<div style="text-align: right;">
                      <button type="button" class="btn btn-dark btn-sm" data-bs-toggle="modal" data-bs-target="#modalEditAccount" onclick="loadAndEditAccount('${b64AccountName}')">
                        Edit
                      </button>
                  </div>`;
        }
      }
    ]
  });
</script>


<!--<%include:/includes/accounts/inc.modal.newaccount.html%>-->
<!--<%include:/includes/accounts/inc.modal.editaccount.html%>-->

<!--<%include:/includes/inc.layout.leftpanel.footer.html%>-->
<!--<%include:/includes/inc.main.footer.html%>-->
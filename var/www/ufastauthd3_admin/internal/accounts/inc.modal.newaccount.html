<script>
    function generateRandomPassword() {

        document.getElementById("pass0TR").style.visibility = "";
        document.getElementById("pass1TR").style.visibility = "collapse";
        document.getElementById("pass2TR").style.visibility = "collapse";
        var proposedPasswd = genNewPassword();
        document.getElementById("newpassGEN").innerText = proposedPasswd;
        document.getElementById("newpass0").value = proposedPasswd;
        document.getElementById("newpass1").value = proposedPasswd;
    }

    function createAccountClearParameters() {

        // Reset all password fields to empty
        document.getElementById("accountName").value = "";
        document.getElementById("newpass0").value = "";
        document.getElementById("newpass1").value = "";
        document.getElementById("newpassGEN").innerText = "";

        // Reset visibility states
        document.getElementById("pass0TR").style.visibility = "collapse";
        document.getElementById("pass1TR").style.visibility = "";
        document.getElementById("pass2TR").style.visibility = "";

        // Reset checkbox states to their original defaults
        document.getElementById("isEnabled").checked = true;
        document.getElementById("isConfirmed").checked = false;
        document.getElementById("isAdmin").checked = false;
        document.getElementById("isBlocked").checked = false;
    }


    function ajaxCreateAccount() {
        var pwdCheck = checkPasswordReq($("#newpass0").val(), 12);

        if ($("#newpass0").val() != $("#newpass1").val()) {
            alert("Password does not match.");
            $("#newpass0").focus();
            return;
        }
        else if (pwdCheck != "") {
            alert(pwdCheck);
            // alert($("#newpass0").val());
            $("#newpass0").focus();
            return;
        }

        $.ajax({
            url: '/api/v1/addAccount',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                slotId: 1,
                secretTempPass: $("#newpass0").val(),
                accountName: $("#accountName").val(),
                flags: {
                    "enabled": $("#isEnabled:checked").length > 0,
                    "confirmed": $("#isConfirmed:checked").length > 0,
                    "admin": $("#isAdmin:checked").length > 0,
                    "blocked": $("#isBlocked:checked").length > 0
                }
            }),
            success: function (response, textStatus, xhr) {
                if (xhr.status === 200) {
                    $('#modalCreateAccount').modal('hide');
                    // Refresh the DataTable after successful user creation
                    var table = new DataTable('#myTable');
                    table.ajax.reload();
                } else {
                    if (response.error && response.message) {
                        alert("Error: " + response.error + " - " + response.message);
                    } else {
                        alert("Error " + xhr.status);
                    }
                }
            },
            error: commonFunctionError
        });
    }

</script>

<div class="modal fade" id="modalCreateAccount" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="modalCreateAccountLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalCreateAccountLabel">Create New User Account</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">


                <table width=100% style=" border-spacing: 10px;   border-collapse: separate;">
                    <tr>
                        <td colspan="2" align="">
                            <h6>Account Info</h6>
                            <hr>
                        </td>
                    </tr>

                    <tr>
                        <td align="right">Account Name: </td>
                        <td><input type="username" name="username" id="accountName" class="form-control"
                                placeholder="Account Name" onkeypress="javascript:checkAccountName()"></td>
                    </tr>

                    <tr>
                        <td colspan="2" align="">
                            <h6>Temporary Master Password</h6>
                            <hr>
                        </td>
                    </tr>

                    <tr valign=top id="pass1TR">
                        <td align="right">New Password:</td>
                        <td align="right"><input type="password" name="password" id="newpass0" class="form-control"
                                placeholder="********">
                        </td>
                    </tr>
                    <tr valign=top id="pass2TR">
                        <td align="right">Confirm New Password:</td>
                        <td align="right"><input type="password" name="password" id="newpass1" class="form-control"
                                placeholder="********">
                        </td>
                    </tr>
                    <tr valign=top id="pass0TR" style="visibility: collapse;">
                        <td align="right">Generated Password:</td>
                        <td align="center">
                            <h6 id="newpassGEN" style=" font-weight: bold; font-family: 'Courier New', monospace;"></h6>
                        </td>
                    </tr>
                    <tr>
                        <td align=""></td>
                        <td align="right"> <button type="button" class="btn btn-secondary"
                                onclick="javascript:generateRandomPassword()">Generate Random Password</button> </td>
                    </tr>

                    <tr>
                        <td colspan="2" align="">
                            <h6>&nbsp;Account Status / Privileges</h6>
                            <hr>
                            <table width=100% style=" border-spacing: 10px;   border-collapse: separate;">
                                <tr valign=top>
                                    <td width=50%>
                                        <table width=100% style=" border-spacing: 10px;   border-collapse: separate;">
                                            <tr>
                                                <td align=""></td>
                                                <td align="right">Enable Account: <input type="checkbox" value=""
                                                        id="isEnabled" checked></td>
                                            </tr>
                                            <tr>
                                                <td align=""></td>
                                                <td align="right">Confirm Account: <input type="checkbox" value=""
                                                        id="isConfirmed"></td>
                                            </tr>

                                        </table>
                                    </td>
                                    <td width=50%>
                                        <table width=100% style=" border-spacing: 10px;   border-collapse: separate;">
                                            <tr>
                                                <td align=""></td>
                                                <td align="right">Administrator Role: <input type="checkbox" value=""
                                                        id="isAdmin"></td>
                                            </tr>

                                            <tr>
                                                <td align=""></td>
                                                <td align="right">Block Account: <input type="checkbox" value=""
                                                        id="isBlocked"></td>
                                            </tr>

                                        </table>
                                    </td>
                                </tr>
                            </table>

                        </td>
                    </tr>

                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" onclick="javascript:ajaxCreateAccount()">Create
                    Account</button>
            </div>
        </div>
    </div>
</div>
<script>
    function generateRandomPassword() {

        document.getElementById("pass0TR").style.visibility = "";
        document.getElementById("pass1TR").style.visibility = "collapse";
        document.getElementById("pass2TR").style.visibility = "collapse";
        var proposedPasswd = genNewPassword();
        document.getElementById("newpassGEN").innerText = proposedPasswd;
        document.getElementById("newpass0").value = proposedPasswd;
        document.getElementById("newpass1").value = proposedPasswd;
    }

    function ajaxCreateUser() {
        var pwdCheck = checkPasswordReq($("#newpass0").val(), 12);

        if ($("#newpass0").val() != $("#newpass1").val()) {
            alert("Password does not match.");
            $("#newpass0").focus();
            return;
        }
        else if (pwdCheck != "") {
            alert(pwdCheck);
           // alert($("#newpass0").val());
            $("#newpass0").focus();
            return;
        }

        var payloadData = {
            secretTempPass: $("#newpass0").val(),
            accountName: $("#accountName").val(),
            isConfirmed: $("#isConfirmed:checked").length > 0,
            isEnabled: $("#isEnabled:checked").length > 0,
            isSuperuser: $("#isSuperuser:checked").length > 0
        };

        $.ajax({
            url: '/api/v1/addAccount',
            data: {
                payload: JSON.stringify(payloadData)
            },
            type: 'POST',
            success: function (response) {
                if (response["retCode"] == false) {
                    alert("User creation failed (" + response["retMsg"] + ").");
                }
                else {
               //     alert("User was created!");
               //     window.location = "/account-edit?" + window.btoa($("#accountName").val());
                }
            },
            error: commonFunctionError
        });
    }

</script>

<div class="modal fade" id="modalCreateUser" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="modalCreateUserLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalCreateUserLabel">Create New User Account</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">


                <table width=100% style=" border-spacing: 10px;   border-collapse: separate;">
                    <tr>
                        <td colspan="2" align="">
                            <h6>Account Info</h6>
                            <hr>
                        </td>
                    </tr>

                    <tr>
                        <td align="right">Account Name: </td>
                        <td><input type="username" name="username" id="accountName" class="form-control"
                                placeholder="Account Name" onkeypress="javascript:checkUserName()"></td>
                    </tr>

                    <tr>
                        <td colspan="2" align="">
                            <h6>Temporary Master Password</h6>
                            <hr>
                        </td>
                    </tr>

                    <tr valign=top id="pass1TR">
                        <td align="right">New Password:</td>
                        <td align="right"><input type="password" name="password" id="newpass0" class="form-control"
                                placeholder="********">
                        </td>
                    </tr>
                    <tr valign=top id="pass2TR">
                        <td align="right">Confirm New Password:</td>
                        <td align="right"><input type="password" name="password" id="newpass1" class="form-control"
                                placeholder="********">
                        </td>
                    </tr>
                    <tr valign=top id="pass0TR" style="visibility: collapse;">
                        <td align="right">Generated Password:</td>
                        <td align="center">
                            <h6 id="newpassGEN" style=" font-weight: bold; font-family: 'Courier New', monospace;"></h6>
                        </td>
                    </tr>
                    <tr>
                        <td align=""></td>
                        <td align="right"> <button type="button" class="btn btn-secondary"
                                onclick="javascript:generateRandomPassword()">Generate Random Password</button> </td>
                    </tr>

                    <tr>
                        <td colspan="2" align="">
                            <h6>&nbsp;Account Status / Privileges</h6>
                            <hr>

                            <table width=100% style=" border-spacing: 10px;   border-collapse: separate;">
                                <tr valign=top>
                                    <td width=50%>
                                        <table width=100% style=" border-spacing: 10px;   border-collapse: separate;">
                                            <tr>
                                                <td align=""></td>
                                                <td align="right">Account Enabled: <input type="checkbox" value=""
                                                        id="isEnabled" checked></td>
                                            </tr>
                                            <tr>
                                                <td align=""></td>
                                                <td align="right">Account Confirmed: <input type="checkbox" value=""
                                                        id="isConfirmed"></td>
                                            </tr>

                                        </table>
                                    </td>
                                    <td width=50%>
                                        <table width=100% style=" border-spacing: 10px;   border-collapse: separate;">
                                            <tr>
                                                <td align=""></td>
                                                <td align="right">Administrator: <input type="checkbox" value=""
                                                        id="isSuperuser"></td>
                                            </tr>

                                        </table>
                                    </td>
                                </tr>
                            </table>

                        </td>
                    </tr>

                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" onclick="javascript:ajaxCreateUser()">Create
                    Account</button>
            </div>
        </div>
    </div>
</div>
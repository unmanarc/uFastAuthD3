<!--<%include:/includes/inc.main.header.html%>-->

<script>
    document.getElementById("apptitle").innerHTML = "Authentication &#9658; Authentication Schemes";
    let authSchemes = [];
</script>

<div class="container-fluid">
    <div class="row">
        <div class="col-8 mx-auto">
            <div class="mb-3 d-flex justify-content-end" style="width: 100%;">
                <button type="button" class="btn btn-success" onclick="createAuthSchemeClearParameters()"
                    data-bs-toggle="modal" data-bs-target="#modalCreateAuthScheme">
                    Add New Authentication Scheme
                </button>
            </div>
            <table class="table table-hover">
                <thead class="thead-light">
                    <tr bgcolor=grey>
                        <th scope="col">Scheme ID</th>
                        <th scope="col">Description</th>
                        <th scope="col" style="text-align: right;">Controls</th>
                    </tr>
                </thead>
                <tbody id="tbody-authSchemes">
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>

    function deleteAuthScheme(schemeId) {

        showYesNoDialog("<b>WARNING:</b> Deleting this authentication scheme might cause <u>some applications to lose login functionality</u>. Affected apps may be unable to authenticate users or authorize access, potentially leading to <i>service disruptions</i>.", function (result) {
            $.ajax({
                url: '/api/v1/deleteAuthenticationScheme',
                type: 'DELETE',
                contentType: 'application/json',
                data: JSON.stringify({
                    schemeId: schemeId
                }),
                success: function (response, textStatus, xhr) {
                    populateTable();
                    showToastSuccess("Scheme removed successfully.");
                },
                error: commonFunctionError
            });
        });

    }


    function populateTable() {
        authSchemes = [];
        $.ajax({
            url: '/api/v1/listAuthenticationSchemes',
            type: 'GET',
            contentType: 'application/json',
            data: JSON.stringify(
                {

                }),
            success: function (response) {
                $("#tbody-authSchemes").empty();

                for (let scheme of response) {
                    let schemeId = parseInt(scheme["id"]);

                    authSchemes[schemeId] = scheme;

                    $("#tbody-authSchemes").append(
                        `<tr> 
                            <th scope="row">${schemeId}</th>
                            <td id="ulist-authSchemeDescription-${schemeId}"></td>
                            <td style="text-align: right;">
                                <button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#modalEditAuthScheme" onclick="javascript:editAuthScheme(${schemeId});"><i class="fas fa-edit"></i></button>
                                <button type="button" class="btn btn-secondary btn-sm" onclick="javascript:deleteAuthScheme(${schemeId});"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>`
                    );

                    $(`#ulist-authSchemeDescription-${schemeId}`).text(scheme["description"]);
                }

            },
            error: commonFunctionError
        });
    }

    populateTable();
</script>

<!--<%include:/includes/authentication-schemes/inc.modal.editauthscheme.html%>-->
<!--<%include:/includes/authentication-schemes/inc.modal.newauthscheme.html%>-->

<!--<%include:/includes/inc.main.footer.html%>-->
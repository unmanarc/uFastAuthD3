<div class="tab-pane" id="scopes" role="tabpanel" aria-labelledby="scopes-tab" style="min-height: 500px;">
    <div class="row">
        <div class="col-12">
            <div class="card" id="addModifyScope">
                <div class="card-header">
                    <b>Add New Scope:</b>
                </div>
                <div class="card-body">
                    <input type="username" name="scopeName" id="scopeName" class="form-control" placeholder="Scope Id"
                        style="text-transform: uppercase" oninput="this.value = this.value.toUpperCase().replace(/[^A-Z0-9_-]/g, '')"><br>
                    <input id="scopeDescription" class="form-control" placeholder="Scope Description">
                    <br>
                    <div class="d-flex justify-content-end">
                        <button type="button" class="btn btn-success" onclick="javascript:addApplicationScope()">Add
                            Application
                            Scope</button>
                    </div>

                </div>
            </div>
            <br>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="thead-light">
                        <tr class="bg-secondary text-white">
                            <th scope="col">ID</th>
                            <th scope="col">Description</th>
                            <th scope="col" style="text-align: right;"></th>
                        </tr>
                    </thead>
                    <tbody id="tbody-scopes">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    function populateApplicationScopes(scopes, modifiable) {
        document.getElementById("tbody-scopes").innerHTML = "";

        if (scopes != null) {
            let scopeId = 0;

            for (let scope of scopes) {
                let removeButton = '';
                if (modifiable === true) {
                    document.getElementById("addModifyScope").style.display = "block";
                    removeButton = `<button type="button" class="btn btn-light btn-sm" onclick="javascript:removeApplicationScope(${scopeId});">&#10006;</button>`;
                }
                else {
                    document.getElementById("addModifyScope").style.display = "none";
                }

                $("#tbody-scopes").append(
                    `<tr> 
                        <th scope="row" id=ulist-scopeName-${scopeId} width=20%></th>
                        <td id=ulist-scopeDescription-${scopeId}></td>
                        <td style="text-align: right;">
                        <input type=hidden id="ulist-scopeNameById-${scopeId}">
                        ${removeButton}
                        </td>
                    </tr>`
                );

                document.getElementById(`ulist-scopeNameById-${scopeId}`).value = scope["id"];
                $(`#ulist-scopeName-${scopeId}`).text(scope["id"]);
                $(`#ulist-scopeDescription-${scopeId}`).text(scope["description"]);
                scopeId++;
            }
        }
    }


    function removeApplicationScope(scopeId) {
        $.ajax({
            url: '/api/v1/removeApplicationScope',
            type: 'DELETE',
            contentType: 'application/json',
            data: JSON.stringify({
                appName: currentApplication,
                scopeId: document.getElementById(`ulist-scopeNameById-${scopeId}`).value
            }),
            success: function (response) {
                // OK 
                populateApplication();
            },
            error: commonFunctionError
        });
    }

    function addApplicationScope() {
        $.ajax({
            url: '/api/v1/addApplicationScope',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                appName: currentApplication,
                scopeId: $("#scopeName").val().toUpperCase(),
                description: $("#scopeDescription").val()
            }),
            success: function (response) {
                $("#scopeName").val("");
                $("#scopeDescription").val("");

                populateApplication();
            },
            error: commonFunctionError
        });
    }


</script>
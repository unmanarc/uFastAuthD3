<!--<%include:/includes/inc.main.header.html%>-->

<script>
    document.getElementById("apptitle").innerHTML = "Authentication &#9658; Authentication Slots";
    let authSlots = [];
</script>

<div class="container-fluid">
    <div class="row">
        <div class="col-8 mx-auto">
            <div class="mb-3 d-flex justify-content-end" style="width: 100%;">
                <button type="button" class="btn btn-success" onclick="createAuthSlotClearParameters()"
                    data-bs-toggle="modal" data-bs-target="#modalCreateAuthSlot">
                    Add New Authentication Slot
                </button>
            </div>
            <table class="table table-hover">
                <thead class="thead-light">
                    <tr bgcolor=grey>
                        <th scope="col">Slot ID</th>
                        <th scope="col">Description</th>
                        <th scope="col">Hash Function</th>
                        <th scope="col" style="text-align: right;">Controls</th>
                    </tr>
                </thead>
                <tbody id="tbody-authSlots">
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    function intFunctionToString(func) {
        switch (func) {
            case 0:
                return "Plain";
            case 1:
                return "SHA256";
            case 2:
                return "SHA512";
            case 3:
                return "SSHA256 (Salted SHA-256)";
            case 4:
                return "SSHA512 (Salted SHA-512)";
            case 5:
                return "TOTP (Time Based OTP)";
            default:
                return "Unknown";
        }
    }


    function deleteAuthSlot(slotId) {

        showYesNoDialog("<b>WARNING:</b> Removing this slot will <u>permanently delete</u> your entire password database and authentication data. This action is <i>irreversible</i> and cannot be undone.", function (result) {
            $.ajax({
                url: '/api/v1/deleteAuthenticationSlot',
                type: 'DELETE',
                contentType: 'application/json',
                data: JSON.stringify({
                    slotId: slotId
                }),
                success: function (response, textStatus, xhr) {
                    populateTable();
                    showToastSuccess("Slot removed successfully.");
                },
                error: commonFunctionError
            });
        });

    }


    function populateTable() {
        authSlots = [];
        $.ajax({
            url: '/api/v1/listAuthenticationSlots',
            type: 'GET',
            contentType: 'application/json',
            data: JSON.stringify(
                {

                }),
            success: function (response) {
                $("#tbody-authSlots").empty();

                for (let slot of response) {
                    let slotId = parseInt(slot["id"]);

                    authSlots[slotId] = slot;

                    $("#tbody-authSlots").append(
                        `<tr> 
                            <th scope="row">${slotId}</th>
                            <td id="ulist-authSlotDescription-${slotId}"></td>
                            <td id="ulist-authSlotFunction-${slotId}"></td>
                            <td style="text-align: right;">
                                <button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#modalEditAuthSlot" onclick="javascript:editAuthSlot(${slotId});"><i class="fas fa-edit"></i></button>
                                <button type="button" class="btn btn-secondary btn-sm" onclick="javascript:deleteAuthSlot(${slotId});"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>`
                    );

                    $(`#ulist-authSlotDescription-${slotId}`).text(slot["description"]);
                    $(`#ulist-authSlotFunction-${slotId}`).text(intFunctionToString(slot["passwordFunction"]));
                }

            },
            error: commonFunctionError
        });
    }

    populateTable();
</script>

<!--<%include:/includes/authentication-slots/inc.modal.editauthslot.html%>-->
<!--<%include:/includes/authentication-slots/inc.modal.newauthslot.html%>-->

<!--<%include:/includes/inc.main.footer.html%>-->
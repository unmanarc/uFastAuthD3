<!DOCTYPE html>
<html lang="en" class="h-100" data-bs-theme="auto">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Authentication Login Page</title>
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css" type="text/css">
    <script src="/assets/js/jquery.min.js" type="text/javascript"></script>

    <link rel="stylesheet" href="local/css/login.css" type="text/css">
    <script src="local/js/login.js" type="text/javascript"></script>
</head>

<!--<%jvar/softwareVersion:softwareVersion%>-->


<body class="d-flex flex-column h-100">
    <!-- Added an outer container with flex to vertically center -->
    <div class="d-flex align-items-center justify-content-center vh-100">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-4" style="min-width: 400px;">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <div class="brand-wrapper">
                                <div class="d-flex justify-content-center">
                                    <img src="local/images/logo.jpg" alt="logo" class="logo" width="300">
                                </div>
                                <p class="login-card-header-text" id="version"></p>
                                <p id="schemeDescription" class="text-center"></p>
                                <p class="login-card-header-message" id="message">_</p>
                            </div>

                            <div id="screenContent">
                                <!-- Screen 1: Username Input -->
                                <form id="usernameForm">
                                    <div class="mb-2">
                                        <input type="text" class="form-control text-center" id="username"
                                            name="username" placeholder="" required>
                                    </div>
                                    <div class="form-check mt-2 mb-3 d-flex justify-content-center">
                                        <input type="checkbox" class="form-check-input" id="keepAuthenticated">
                                        <br>
                                        <label class="form-check-label" for="keepAuthenticated">&nbsp;Stay logged in on
                                            this device</label>
                                    </div>

                                    <button type="submit" class="btn btn-dark w-100">Next</button>
                                </form>

                                <!-- Screen 2: Generic Input -->
                                <form id="genericPasswordForm" class="d-none">
                                    <!-- <h6 id="slotDescription" class="text-center mb-3"></h6> -->
                                    <div class="mb-2">
                                        <input type="password" class="form-control text-center" id="genericPassword"
                                            name="genericPassword" placeholder="" required>
                                    </div>
                                    <hr>
                                    <div class="mb-2">
                                        <button type="submit" class="btn btn-dark w-100">Submit</button>
                                    </div>
                                    <div class="mb-2">
                                        <button class="btn btn-warning w-100" onclick="logout();">Restart</button>
                                    </div>
                                </form>

                                <!-- Screen 3: OTP Token Input -->
                                <form id="otpForm" class="d-none">
                                    <!-- <h6 id="slotDescription" class="text-center mb-3">Enter OTP</h6> -->
                                    <div class="mb-2">
                                        <input type="text" class="form-control text-center" id="otp" name="otp"
                                            placeholder="Enter your OTP" required>
                                    </div>
                                    <hr>
                                    <div class="mb-2">
                                        <button type="submit" class="btn btn-dark w-100">Verify</button>
                                    </div>
                                    <div class="mb-2">
                                        <button class="btn btn-warning w-100" onclick="logout();">Restart</button>
                                    </div>
                                </form>

                                <!-- Screen 4: External Authorization Waiting -->
                                <div id="authWaiting" class="d-none text-center">
                                    <p>Please approve the login request on your external device.</p>
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>

                                <!-- Screen 5: Logout -->
                                <div id="logoutForm" class="d-none">
                                    <div class="mb-2">
                                        <button class="btn btn-success w-100" onclick="loadTokenAndRedirect();">Continue
                                            to the application</button>
                                    </div>
                                    <div class="mb-2">
                                        <button class="btn btn-warning w-100" onclick="logout();">Logout</button>
                                    </div>
                                    <div>
                                    </div>

                                    <div id="logoutform" style="display: none;">
                                        <button type="button" class="btn btn-danger w-100"
                                            onclick="ajaxLogout()">Logout</button>
                                    </div>
                                </div>



                            </div>
                        </div>
                    </div>


                    <div class="row text-center justify-content-center" style="font-size: 10px">
                        <br>
                        Licenced under SSPLv1
                        <a href="https://github.com/unmanarc/libMantids30" style="font-size: 10px"
                            target="_blank">Powered by libMantids3</a>
                    </div>



                </div>
            </div>

            <script>
                $('#username').keypress(function (e) {
                    if (e.which === 13) { // Enter key
                        $('#password').focus();
                    }
                });
                $('#password').keypress(function (e) {
                    var key = e.which;
                    if (key == 13)  // the enter key code
                    {
                        ajaxLogin();
                    }
                });
            </script>
            <script src="/assets/js/bootstrap.min.js" type="text/javascript"></script>
</body>

</html>
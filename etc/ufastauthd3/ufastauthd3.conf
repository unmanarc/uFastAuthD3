; Sample Configuration File for RESTful Service

; Logs
Logs {
    Debug "true"
    ShowDate "true"
    ShowColors "true"
}

; Auth
Auth {
    Driver "SQLite3"
    IAMMainFile "var/lib/ufastauthd3/main.db"
    IAMLogsFile "var/log/ufastauthd3/logs.db"
    TerminateOnSQLError "true"
}

AppSyncWebService
{
    ; General Settings
    ListenPort 7081            ; Port to listen on
    ListenAddr "127.0.0.1"       ; Address to listen on (localhost, all interfaces?)
    UseIPv6 false                 ; Use IPv6 instead of IPv4

    ResourcesPath "var/www/ufastauthd3/appsync"  ; Default path for web resources


    ; TLS Configuration (if UseTLS is true)
    UseTLS true                ; Enable or disable TLS
    TLS
    {
        CertFile "etc/ufastauthd3/tls/snakeoil.crt"   ; Path to the public certificate file in PEM format
        KeyFile  "etc/ufastauthd3/tls/snakeoil.key"   ; Path to the private key file in PEM format
    }

    ; Thread Pool Configuration
    Threads
    {
        UseThreadPool false          ; Use a thread pool instead of multi-threading
        ;PoolSize 20                  ; Number of threads in the pool (if using ThreadPool)
        MaxThreads 500               ; Maximum number of concurrent threads (if not using ThreadPool)
    }

    Logs
    {
        ; Directory where log files will be stored
        Dir "var/log/ufastauthd3"

        ; Whether to create the log directory if it does not exist
        CreateDir "true"

        ; Base filename for log files (e.g., webservice.log)
        File "web_appsync.log"

        ; Maximum size of a log file before rotation occurs (e.g., "1Kb", "10Mb", "1Gb")
        MaxFileSize "10mb"

        ; Maximum number of backup log files to retain (old logs are deleted after this limit)
        MaxBackups 5

        ; If true, rotate log files when the server starts up
        RotateOnStartup "true"

        ; If true, rotate log files when they reach MaxFileSize
        RotateOnSize "true"

        ; Log format: "json", "combined"
        LogFormat "combined"

        ; Enable scheduled rotation
        RotateOnSchedule "false"

        ; Log Rotation Schedule
        ; Define specific times for log rotation based on day, hour, month, or year
        ; For example, rotate every day at 2 AM:
        RotateSchedule {
            Minute "*"
            Hour "2"
            DayOfWeek "*"
            DayOfMonth "*"
            Month "*"
        }

        ; Queue settings for logging
        QueueMaxItems 10000
        QueueMaxInsertWaitTimeInMS 100
        UseThreadedQueue "true"
    }
}

WebSessionAuthHandlerService
{
    ; you can use your own personalized Auth Handler inside your app, but we provide one 
    ; synchronized with the APP JWT token, so don't need to code many things related with the authentication.
    ; the code provided here will be in charge to:
    ;
    ; - setup the authentication cookies during login process
    ; - validate the incomming JWT signatures
    ; - provide the logout interface (removing the JWT Token)

    ; General Settings
    ListenPort 7080            ; Port to listen on
    ListenAddr "127.0.0.1"       ; Address to listen on (localhost, all interfaces?)
    UseIPv6 false                 ; Use IPv6 instead of IPv4
 
    Login
    {
        Origins "https://login.localhost:8443"
        CallbackMethodName "callback"
    }

    ResourcesPath "var/www/ufastauthd3/authhandler"  ; Default path for web resources

    ; TLS Configuration (if UseTLS is true)
    UseTLS false                ; Enable or disable TLS
;   TLS
;   {
;       CertFile "etc/ufastauthd3/tls/snakeoil.crt"   ; Path to the public certificate file in PEM format
;       KeyFile  "etc/ufastauthd3/tls/snakeoil.key"   ; Path to the private key file in PEM format
;   }

    ; Thread Pool Configuration
    Threads
    {
        UseThreadPool false          ; Use a thread pool instead of multi-threading
        ;PoolSize 20                  ; Number of threads in the pool (if using ThreadPool)
        MaxThreads 500               ; Maximum number of concurrent threads (if not using ThreadPool)
    }

    Logs
    {
        ; Directory where log files will be stored
        Dir "var/log/ufastauthd3"

        ; Whether to create the log directory if it does not exist
        CreateDir "true"

        ; Base filename for log files (e.g., webservice.log)
        File "web_sessionauthhandler.log"

        ; Maximum size of a log file before rotation occurs (e.g., "1Kb", "10Mb", "1Gb")
        MaxFileSize "10mb"

        ; Maximum number of backup log files to retain (old logs are deleted after this limit)
        MaxBackups 5

        ; If true, rotate log files when the server starts up
        RotateOnStartup "true"

        ; If true, rotate log files when they reach MaxFileSize
        RotateOnSize "true"

        ; Log format: "json", "combined"
        LogFormat "combined"

        ; Enable scheduled rotation
        RotateOnSchedule "false"

        ; Log Rotation Schedule
        ; Define specific times for log rotation based on day, hour, month, or year
        ; For example, rotate every day at 2 AM:
        RotateSchedule {
            Minute "*"
            Hour "2"
            DayOfWeek "*"
            DayOfMonth "*"
            Month "*"
        }

        ; Queue settings for logging
        QueueMaxItems 10000
        QueueMaxInsertWaitTimeInMS 100
        UseThreadedQueue "true"
    }
}

; Web Login Service
WebLoginService
{
    ; General Settings
    ListenPort 8443            ; Port to listen on
    ListenAddr "0.0.0.0"       ; Address to listen on (all interfaces)
    UseIPv6 false                 ; Use IPv6 instead of IPv4

    ; TLS Configuration (if UseTLS is true)
    UseTLS true                ; Enable or disable TLS
    TLS
    {
        CertFile "etc/ufastauthd3/tls/snakeoil.crt"   ; Path to the public certificate file in PEM format
        KeyFile  "etc/ufastauthd3/tls/snakeoil.key"   ; Path to the private key file in PEM format
    }

    ; Resource and Document Root Settings
    ResourcesPath "var/www/ufastauthd3/login"  ; Default path for web resources

    ; API Configuration
    API
    {
        Origins "https://login.localhost:8443"            ; Permitted origins for API requests (comma-separated)
    }

    ; JWT Configuration
    JWT {
        Algorithm "HS256"
        CreateIfNotPresent "true"
        HMACSecretFile "etc/ufastauthd3/jwt/hmac_secret.key"
        PublicKeyFile ""
        PrivateKeyFile ""
    }

    ; Thread Pool Configuration
    Threads
    {
        UseThreadPool false          ; Use a thread pool instead of multi-threading
        ;PoolSize 20                  ; Number of threads in the pool (if using ThreadPool)
        MaxThreads 500               ; Maximum number of concurrent threads (if not using ThreadPool)
    }

    ; Time passed until the authentication intermediary token is timed out
    AuthenticationTimeout 150
    ; duration of the IAM Token (User logged in into our IAM...)
    IAMTokenTimeout 2592000

    Registration {
        AllowSelfRegistration false
        AutoConfirm false
    }

    Logs
    {
        ; Directory where log files will be stored
        Dir "var/log/ufastauthd3"

        ; Whether to create the log directory if it does not exist
        CreateDir "true"

        ; Base filename for log files (e.g., webservice.log)
        File "web_login.log"

        ; Maximum size of a log file before rotation occurs (e.g., "1Kb", "10Mb", "1Gb")
        MaxFileSize "10mb"

        ; Maximum number of backup log files to retain (old logs are deleted after this limit)
        MaxBackups 5

        ; If true, rotate log files when the server starts up
        RotateOnStartup "true"

        ; If true, rotate log files when they reach MaxFileSize
        RotateOnSize "true"

        ; Log format: "json", "combined"
        LogFormat "combined"

        ; Enable scheduled rotation
        RotateOnSchedule "false"

        ; Log Rotation Schedule
        ; Define specific times for log rotation based on day, hour, month, or year
        ; For example, rotate every day at 2 AM:
        RotateSchedule {
            Minute "*"
            Hour "2"
            DayOfWeek "*"
            DayOfMonth "*"
            Month "*"
        }

        ; Queue settings for logging
        QueueMaxItems 10000
        QueueMaxInsertWaitTimeInMS 100
        UseThreadedQueue "true"
    }


    ; Logging Settings (TODO)
    ;LogFilePath "/var/log/restful_service.log"  ; Path to the log file
}


; Web Admin Service (Admin Website for the IAM)
WebAdminService
{
    ; General Settings
    ListenPort 9443            ; Port to listen on
    ListenAddr "0.0.0.0"       ; Address to listen on (all interfaces)
    UseIPv6 false                 ; Use IPv6 instead of IPv4

    ; TLS Configuration (if UseTLS is true)
    UseTLS true                ; Enable or disable TLS
    TLS
    {
        CertFile "etc/ufastauthd3/tls/snakeoil.crt"   ; Path to the public certificate file in PEM format
        KeyFile  "etc/ufastauthd3/tls/snakeoil.key"   ; Path to the private key file in PEM format
    }

    ; Resource and Document Root Settings
    ResourcesPath "var/www/ufastauthd3/admin"  ; Default path for web resources

    ; API Configuration
    API
    {
        Origins "https://iamadmin.localhost:9443"            ; Permitted origins for API requests (comma-separated)
    }

    ; Login Configuration
    Login
    {
        Origins "https://login.localhost:8443"       ; Permitted origins for login requests (comma-separated)
        RedirectURL "https://login.localhost:8443/?app=IAM&redirectURI=&loggedIn=false"   ; URL to redirect after successful login
    }

    ; Thread Pool Configuration
    Threads
    {
        UseThreadPool false          ; Use a thread pool instead of multi-threading
;        PoolSize 20                  ; Number of threads in the pool (if using ThreadPool)
        MaxThreads 10000             ; Maximum number of concurrent threads (if not using ThreadPool)
    }

    ; HTTP Proxies to the authorization endpoint
    Proxies
    {
        "/auth" {
            ; ApiProxy Configuration
            UseTLS false   ; Use TLS
;            TLS
;            {
;                CheckTLSPeer false   ; Check TLS peer 
;                UsePrivateCA false   ; Do not use private CA
;                PrivateCAPath "/path/to/ca.pem"   ; Path to private CA (if UsePrivateCA were true)
;            }
            RemoteHost "127.0.0.1"   ; Remote host
            RemotePort 7080   ; Remote port
            ExtraHeaders ; Custom header values
            {
                "x-api-key" "%APIKEY%"
            }
        }
    }

    ; Temporary Redirections
    Redirections
    {
        "/login" "https://login.localhost:8443/?app=IAM&redirectURI=aHR0cHM6Ly9pYW1hZG1pbi5sb2NhbGhvc3Q6OTQ0My8="
    }

    Logs
    {
        ; Directory where log files will be stored
        Dir "var/log/ufastauthd3"

        ; Whether to create the log directory if it does not exist
        CreateDir "true"

        ; Base filename for log files (e.g., webservice.log)
        File "web_admin.log"

        ; Maximum size of a log file before rotation occurs (e.g., "1Kb", "10Mb", "1Gb")
        MaxFileSize "10mb"

        ; Maximum number of backup log files to retain (old logs are deleted after this limit)
        MaxBackups 5

        ; If true, rotate log files when the server starts up
        RotateOnStartup "true"

        ; If true, rotate log files when they reach MaxFileSize
        RotateOnSize "true"

        ; Log format: "json", "combined"
        LogFormat "combined"

        ; Enable scheduled rotation
        RotateOnSchedule "false"

        ; Log Rotation Schedule
        ; Define specific times for log rotation based on day, hour, month, or year
        ; For example, rotate every day at 2 AM:
        RotateSchedule {
            Minute "*"
            Hour "2"
            DayOfWeek "*"
            DayOfMonth "*"
            Month "*"
        }

        ; Queue settings for logging
        QueueMaxItems 10000
        QueueMaxInsertWaitTimeInMS 100
        UseThreadedQueue "true"
    }

    ; Logging Settings (TODO)
    ;LogFilePath "/var/log/restful_service.log"  ; Path to the log file
}
